<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Elysia Player</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="player" class="glass">
    <div id="songTitle">加载中...</div>
    <audio id="audio" controls></audio>

    <div id="controls">
      <button id="prevBtn">⏮️</button>
      <button id="playPauseBtn">▶️</button>
      <button id="nextBtn">⏭️</button>
    </div>

    <div id="playlist"></div>
  </div>

  <script>
    // === 歌曲列表 ===
    const songs = [
      { title: "AKIBA POP the Future - Pianeet", src: "assets/AKIBA POP the Future - Pianeet [Piano Transcription].mp3" },
      { title: "Aoi Tori - The iDOLM", src: "assets/[Pianeet] Aoi Tori - The iDOLM@STER OST - Piano Tutorial  Synthesia.mp3" },
      { title: "Flower Dance - DJ Okawari", src: "assets/Flower Dance - DJ Okawari (Piano Cover by Riyandi Kusuma).mp3" },
    ];

    const audio = document.getElementById("audio");
    const songTitle = document.getElementById("songTitle");
    const playPauseBtn = document.getElementById("playPauseBtn");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const playlistDiv = document.getElementById("playlist");

    let currentSong = 0;

    // === 初始化播放列表 ===
    function renderPlaylist() {
      playlistDiv.innerHTML = songs
        .map((s, i) => `<div class="song ${i === currentSong ? "active" : ""}" data-index="${i}">${s.title}</div>`)
        .join("");
    }

    // === 切换歌曲 ===
    function updateSong() {
      const song = songs[currentSong];
      audio.src = song.src;
      songTitle.textContent = song.title;
      renderPlaylist();
      updateMediaSession();
      audio.play().catch(()=>{});
      playPauseBtn.textContent = "⏸️";
    }

    // === 播放 / 暂停 ===
    playPauseBtn.addEventListener("click", () => {
      if (audio.paused) {
        audio.play();
        playPauseBtn.textContent = "⏸️";
      } else {
        audio.pause();
        playPauseBtn.textContent = "▶️";
      }
    });

    nextBtn.addEventListener("click", () => {
      currentSong = (currentSong + 1) % songs.length;
      updateSong();
    });

    prevBtn.addEventListener("click", () => {
      currentSong = (currentSong - 1 + songs.length) % songs.length;
      updateSong();
    });

    playlistDiv.addEventListener("click", e => {
      const item = e.target.closest(".song");
      if (item) {
        currentSong = parseInt(item.dataset.index);
        updateSong();
      }
    });

    audio.addEventListener("ended", () => {
      currentSong = (currentSong + 1) % songs.length;
      updateSong();
    });

    // === Media Session API（灵动岛 + 锁屏） ===
    function updateMediaSession() {
      if (!("mediaSession" in navigator)) return;

      // 每首歌尝试加载对应封面
      const songSrc = songs[currentSong].src;
      const baseName = songSrc.replace(/\.[^/.]+$/, ""); // 去掉.mp3后缀
      const coverPath = baseName + ".jpg";
      const defaultCover = "assets/banner.jpg";

      navigator.mediaSession.metadata = new MediaMetadata({
        title: songs[currentSong].title,
        artist: "Elysia Player",
        album: "Piano Collection",
        artwork: [
          { src: coverPath, sizes: "96x96", type: "image/jpeg" },
          { src: coverPath, sizes: "128x128", type: "image/jpeg" },
          { src: coverPath, sizes: "192x192", type: "image/jpeg" },
          { src: coverPath, sizes: "256x256", type: "image/jpeg" },
          { src: coverPath, sizes: "512x512", type: "image/jpeg" },
          { src: defaultCover, sizes: "512x512", type: "image/jpeg" } // 兜底封面
        ]
      });

      navigator.mediaSession.playbackState = audio.paused ? "paused" : "playing";

      try {
        navigator.mediaSession.setActionHandler("play", () => {
          audio.play(); playPauseBtn.textContent = "⏸️";
        });
        navigator.mediaSession.setActionHandler("pause", () => {
          audio.pause(); playPauseBtn.textContent = "▶️";
        });
        navigator.mediaSession.setActionHandler("previoustrack", () => {
          currentSong = (currentSong - 1 + songs.length) % songs.length;
          updateSong();
        });
        navigator.mediaSession.setActionHandler("nexttrack", () => {
          currentSong = (currentSong + 1) % songs.length;
          updateSong();
        });
      } catch(e){}
    }

    audio.addEventListener("play", () => updateMediaSession());
    audio.addEventListener("pause", () => updateMediaSession());

    renderPlaylist();
    updateSong();
  </script>

  <style>
    /* 液态玻璃风格 */
    #player {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 16px 24px;
      border-radius: 16px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 32px rgba(150, 110, 240, 0.3);
      color: #fff;
      text-align: center;
      z-index: 9999;
      animation: float 6s ease-in-out infinite;
    }
    @keyframes float {
      0%,100% { transform: translate(-50%, 0); }
      50% { transform: translate(-50%, -6px); }
    }
    #controls button {
      background: rgba(255,255,255,0.15);
      border: 1px solid rgba(255,255,255,0.2);
      color: white;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      cursor: pointer;
      margin: 0 6px;
      transition: all .2s;
    }
    #controls button:hover {
      background: rgba(180,150,255,0.3);
      transform: scale(1.1);
    }
    #songTitle {
      font-weight: 600;
      margin-top: 8px;
      text-shadow: 0 0 12px rgba(160,120,255,0.5);
    }
    #playlist {
      margin-top: 12px;
      max-height: 200px;
      overflow-y: auto;
      background: rgba(255,255,255,0.08);
      border-radius: 12px;
      padding: 10px;
    }
    .song {
      padding: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      border-radius: 8px;
    }
    .song:hover {
      background: rgba(180,150,255,0.2);
    }
    .song.active {
      background: rgba(160,120,255,0.3);
      box-shadow: 0 0 8px rgba(160,120,255,0.5);
    }
  </style>
</body>
</html>