<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Elysia â€” åˆ†ç»„æ’­æ”¾å™¨ï¼ˆpiano é»˜è®¤ï¼‰</title>
<style>
  :root{
    --width-player: 300px; /* æ’­æ”¾å™¨æ€»å®½åº¦ (å›ºå®š) */
    --group-w: 90px;      /* åˆ†ç»„æ å®½ */
    --list-w: 200px;      /* åˆ—è¡¨å®½ (group + list <= player) */
    --accent: #a06bff;
    --muted: rgba(200,180,255,0.28);
    --glass: rgba(255,255,255,0.08);
  }

  html,body{height:100%;margin:0;background:#fff; font-family:Inter, "PingFang SC","Microsoft Yahei",sans-serif;color:#4b3c88; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;}

  /* subtle background glow like Elysia */
  body::before{
    content:"";position:fixed;inset:0;z-index:-2;
    background:
      radial-gradient(600px 300px at 10% 20%, rgba(205,171,255,0.10), transparent 12%),
      radial-gradient(500px 260px at 85% 85%, rgba(180,140,255,0.06), transparent 12%),
      linear-gradient(180deg,#ffffff,#fff8ff);
    pointer-events:none;
  }

  /* ===== æ’­æ”¾å™¨ï¼ˆå°å·§ï¼Œå±…ä¸­ï¼‰ ===== */
  .elysia-player {
    position: fixed;
    left: 50%;
    bottom: 20px;
    transform: translateX(-50%);
    width: var(--width-player);
    height: 56px;
    display:flex;
    align-items:center;
    gap: 12px;
    padding: 8px 14px;
    border-radius: 16px;
    z-index: 9999;
    background: linear-gradient(180deg, rgba(255,255,255,0.92), rgba(255,255,255,0.9));
    border: 1px solid rgba(180,150,255,0.32);
    backdrop-filter: blur(14px) saturate(160%);
    -webkit-backdrop-filter: blur(14px) saturate(160%);
    box-shadow: 0 10px 30px rgba(180,140,255,0.14), inset 0 1px 0 rgba(255,255,255,0.6);
    transition: opacity .45s ease, transform .45s ease;
    will-change: transform, opacity;
  }
  .elysia-player.playing { box-shadow: 0 14px 44px rgba(160,120,255,0.18), inset 0 2px 18px rgba(255,255,255,0.5); transform: translateX(-50%) translateY(-2px); }

  .elysia-controls { display:flex; gap:10px; align-items:center; margin-left:4px; }
  .elysia-controls button{
    width:36px;height:36px;border-radius:50%;
    background: linear-gradient(180deg, rgba(255,255,255,0.96), rgba(255,255,255,0.9));
    border:1px solid rgba(200,170,255,0.5);
    box-shadow: 0 6px 18px rgba(160,120,255,0.06);
    display:flex;align-items:center;justify-content:center;
    color:var(--accent); font-weight:700; cursor:pointer; transition: transform .18s ease, box-shadow .18s ease;
  }
  .elysia-controls button:hover { transform: scale(1.06); box-shadow: 0 10px 26px rgba(160,120,255,0.12); }

  #songTitle{
    color: var(--accent);
    font-weight:600;
    font-size: 0.95rem;
    white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    cursor:pointer;
    text-shadow: 0 0 10px rgba(160,120,255,0.12);
  }

  /* ===== æ’­æ”¾åˆ—è¡¨ + åˆ†ç»„æ•´ä½“å®¹å™¨ï¼ˆå’Œæ’­æ”¾å™¨å¯¹é½ï¼‰ ===== */
  .elysia-playlist-container {
    position: fixed;
    left: 50%;
    bottom: calc(20px + 56px + 8px); /* åœ¨æ’­æ”¾å™¨ä¸Šæ–¹ï¼Œä¿æŒé—´è· */
    transform: translateX(-50%) translateY(12px);
    width: var(--width-player);
    display:flex;
    gap: 8px;
    align-items:flex-start;
    z-index:9998;
    pointer-events:none;
    opacity:0;
    transition: transform .45s cubic-bezier(.2,.9,.2,1), opacity .36s ease;
  }
  .elysia-playlist-container.show {
    transform: translateX(-50%) translateY(0);
    opacity:1;
    pointer-events:auto;
  }

  /* å·¦ä¾§åˆ†ç»„æ ï¼ˆé«˜åº¦ä¸å³ä¾§åˆ—è¡¨ä¿æŒä¸€è‡´ï¼‰ */
  .elysia-group-panel {
    width: var(--group-w);
    border-radius: 14px;
    padding: 8px;
    background: rgba(255,240,255,0.25);
    border: 1px solid rgba(255,210,255,0.32);
    backdrop-filter: blur(12px) saturate(160%);
    -webkit-backdrop-filter: blur(12px) saturate(160%);
    box-shadow: 0 10px 28px rgba(200,160,255,0.14);
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:6px;
    min-height: 48px; /* will be adjusted by playlist height via JS */
    transition: box-shadow .25s ease, transform .25s ease;
  }
  .group-item {
    font-size:0.86rem;
    color:#cdbaff;
    padding:6px 8px;
    border-radius:10px;
    cursor:pointer;
    width:100%;
    text-align:center;
    transition: background .18s ease, color .18s ease, transform .18s ease;
  }
  .group-item:hover { background: rgba(160,120,255,0.14); color:#fff; transform: translateY(-2px); }
  .group-item.active {
    background: rgba(160,120,255,0.26); color:#fff;
    box-shadow: 0 6px 20px rgba(160,120,255,0.25);
  }

  /* å³ä¾§æ’­æ”¾åˆ—è¡¨ï¼ˆä¸»é«˜åº¦ã€åŠ¨ç”»ä¸åŸç‰ˆä¸€è‡´ï¼‰ */
  .elysia-playlist {
    width: var(--list-w);
    max-height: 260px;
    min-height: 48px;
    padding: 10px;
    border-radius: 14px;
    background: rgba(255, 255, 255, 0.9);
    border: 1px solid rgba(180,150,255,0.28);
    backdrop-filter: blur(12px) saturate(180%);
    -webkit-backdrop-filter: blur(12px) saturate(180%);
    box-shadow: 0 12px 34px rgba(200,160,255,0.12), inset 0 1px 0 rgba(255,255,255,0.65);
    overflow-y:auto;
    transition: transform .36s cubic-bezier(.2,.9,.2,1), opacity .28s ease;
  }

  .playlist-item {
    padding: 8px 10px;
    color: #6b5b95;
    border-radius: 8px;
    cursor:pointer;
    margin-bottom:6px;
    transition: background .18s ease, color .18s ease, transform .12s ease;
    text-align:left;
  }
  .playlist-item:hover { background: rgba(160,120,255,0.12); color: #fff; transform: translateX(6px); }
  .playlist-item.active { background: linear-gradient(90deg, rgba(180,140,255,0.24), rgba(200,160,255,0.16)); color:#fff; box-shadow: 0 6px 18px rgba(160,120,255,0.12); }

  /* å­å…ƒç´ å‡ºç°åŠ¨ç”»ï¼ˆä¸ Elyisa åŸå…ˆé£æ ¼æ¥è¿‘ï¼‰ */
  @keyframes dockBounceOpen {
    0%   { transform: translateY(18px) scale(.98); opacity:0; }
    60%  { transform: translateY(-6px) scale(1.02); opacity:1; }
    100% { transform: translateY(0) scale(1); opacity:1; }
  }

  .elysia-playlist-container.show .elysia-playlist { animation: dockBounceOpen .48s cubic-bezier(.22,1.6,.36,1) both; }
  .elysia-playlist-container.show .elysia-group-panel { animation: dockBounceOpen .48s cubic-bezier(.22,1.6,.36,1) both; }

  /* scrollbar */
  .elysia-playlist::-webkit-scrollbar{ width:8px; }
  .elysia-playlist::-webkit-scrollbar-thumb{ background: rgba(180,140,255,0.28); border-radius:6px; }

  /* responsive small screens: scale down */
  @media (max-width:420px){
    :root { --width-player: 280px; --group-w:80px; --list-w:180px; }
    .elysia-player{ width:var(--width-player); padding:8px; height:52px; }
  }
</style>
</head>
<body>

<!-- ========== å°å·§æ’­æ”¾å™¨ï¼ˆæ¢å¤åŸå§‹å°ºå¯¸ï¼š300pxï¼‰ ========== -->
<div class="elysia-player" id="elysiaPlayer" role="region" aria-label="Elysia Player">
  <div class="elysia-controls" aria-hidden="true">
    <button id="playPauseBtn" aria-label="Play/Pause">â–¶</button>
    <button id="nextBtn" aria-label="Next">â­</button>
  </div>
  <span id="songTitle" class="clickable" role="button" tabindex="0">åŠ è½½ä¸­...</span>
</div>

<!-- ========== æ’­æ”¾åˆ—è¡¨å®¹å™¨ï¼ˆå·¦ä¾§åˆ†ç»„ + å³ä¾§æ­Œæ›²ï¼‰ ========== -->
<div class="elysia-playlist-container" id="playlistContainer" aria-hidden="true">
  <div class="elysia-group-panel" id="groupPanel" aria-hidden="true">
    <div class="group-item active" data-group="piano">ğŸ¹ piano</div>
    <div class="group-item" data-group="chinesesong">ğŸµ chinesesong</div>
  </div>

  <div class="elysia-playlist" id="playlist" aria-hidden="true"></div>
</div>

<script>
/* ===== songs (full list you provided earlier) ===== */
const songs = [
  { title: "My Soul, Your Beats!", src: "assets/My Soul, Your Beats! -Piano Arrange Ver.-.mp3", cover: "assets/My Soul, Your Beats! -Piano Arrange Ver.-.jpg", group: "piano" },
  { title: "My Most Precious Treasure", src: "assets/My Most Precious Treasure (From My Most Precious Treasure).mp3", cover: "assets/My Most Precious Treasure (From My Most Precious Treasure).jpg", group: "piano" },
  { title: "Shiteki de Souseiteki na Tori-tachi e no Shirabe", src: "assets/Shiteki de Souseiteki na Tori-tachi e no Shirabe (Yokunin no Tame no Piano Sanka).mp3", cover: "assets/Shiteki.jpg", group: "piano" },
  { title: "Last regrets, foretting me", src: "assets/Last regrets,foretting me.mp3", cover: "assets/banner1.jpg", group: "piano" },
  { title: "Megumeru Gensoukyoku", src: "assets/Megumeru Gensoukyoku.mp3", cover: "assets/Megumeru Gensoukyoku.jpg", group: "piano" },
  { title: "Call of Silence", src: "assets/Call of Silence (From Attack on Titian) Piano Cover.mp3", cover: "assets/banner1.jpg", group: "piano" },
  { title: "Only my Railgun OP1 fripSide", src: "assets/Only my Railgun - A Certain Scientific Railgun OP1 [Piano]  fripSide.mp3", cover: "assets/banner1.jpg", group: "piano" },
  { title: "Aoi Tori - The iDOLM", src: "assets/[Pianeet] Aoi Tori - The iDOLM@STER OST - Piano Tutorial  Synthesia.mp3", cover: "assets/banner1.jpg", group: "piano" },
  { title: "é¬¼æ»…ä¹‹åˆƒ OPLiSA - ç´…è“®è¯", src: "assets/é¬¼æ»…ä¹‹åˆƒ OPLiSA - ç´…è“®è¯ Piano Cover.mp3", cover: "assets/banner1.jpg", group: "piano" },
  { title: "Flower Dance - DJ Okawari", src: "assets/Flower Dance - DJ Okawari (Piano Cover by Riyandi Kusuma).mp3", cover: "assets/Flower Dance - DJ Okawari.jpg", group: "piano" },
  { title: "theme of SSS -Piano Arrange ", src: "assets/theme of SSS -Piano Arrange Ver.-.mp3", cover: "assets/banner1.jpg", group: "piano" },
  { title: "My Soul, Your Beats! Classic", src: "assets/My Soul, Your Beats! ~Classic~ Instrumental.mp3", cover: "assets/My Soul, Your Beats! ~Classic~ Instrumental.jpg", group: "piano" },
  { title: "Pachelbel's Canon", src: "assets/Bi.Bi PianoPachelbel's Canon ç»ˆäºå¼¹äº†è¿™é¦– ä¸–ç•Œä¸Šæœ€æ²»æ„ˆçš„é’¢ç´æ›²å¡å†œ.mp3", cover: "assets/banner1.jpg", group: "piano" },
  { title: "Heroism endures in nothingness", src: "assets/è‹±é›„ä¸»ä¹‰-åœ¨è™šæ— ä¸­æ°¸å­˜.mp3", cover: "assets/banner1.jpg", group: "piano" },
  { title: "è¯€åˆ«ä¹¦", src: "assets/é’¢ç´æ¼”å¥è¯€åˆ«ä¹¦çº¯éŸ³ä¹ç²¾ç¼–å®Œæ•´ç‰ˆ.mp3", cover: "assets/banner1.jpg", group: "chinesesong" },
  { title: "Key anime piano medley", src: "assets/Air (TV), Kanon (2006), Clannad After Story - Key anime piano medley.mp3", cover: "assets/banner1.jpg", group: "piano" },
  { title: "Crying for Rain", src: "assets/Crying for Rain (Kawaki wo Ameku) - Domestic na Kanojo OP [Piano]  Minami.mp3", cover: "assets/banner1.jpg", group: "piano" },
  { title: "GIRLS BAND CRY", src: "assets/GIRLS BAND CRY OP - Wrong World - Piano Cover  TOGENASHI TOGEARI.mp3", cover: "assets/banner1.jpg", group: "piano" },
  { title: "Hikari no Senritsu", src: "assets/Hikari no Senritsu - Sora no Woto OP Arr. Animenz (2024 Fan Remaster Visualized).mp3", cover: "assets/banner1.jpg", group: "piano" },
  { title: "LEVEL5 -judgelight", src: "assets/LEVEL5 -judgelight- A Certain Scientific Railgun OP2 [Piano].mp3", cover: "assets/banner1.jpg", group: "piano" },
  { title: "Majo no Tabitabi", src: "assets/Majo no Tabitabi OPLiterature Piano Cover.mp3", cover: "assets/banner1.jpg", group: "piano" },
  { title: "My Dearest ", src: "assets/My Dearest - Guilty Crown OP [10 Year Anniversary Edition] [Piano].mp3", cover: "assets/Mydearest.png", group: "piano" },
  { title: "Ninelie Kabaneri", src: "assets/Ninelie - Kabaneri of the Iron Fortress ED [Piano].mp3", cover: "assets/banner1.jpg", group: "piano" },
  { title: "One Last Kiss", src: "assets/One Last Kiss - Evangelion_ 3.0  1.0 Theme Song [Piano]  Hikaru Utada.mp3", cover: "assets/banner1.jpg", group: "piano" },
  { title: "secret base", src: "assets/secret base - Kimi ga Kureta Mono - AnoHana ED [Piano].mp3", cover: "assets/banner1.jpg", group: "piano" },
  { title: "Blue Bird 2022 ver.", src: "assets/Blue Bird (2022 ver.) - Naruto Shippuuden OP3 [Piano]  Ikimono-gakari.mp3", cover: "assets/banner1.jpg", group: "piano" },
  { title: "AKIBA POP the Future - Pianeet", src: "assets/AKIBA POP the Future - Pianeet [Piano Transcription].mp3", cover: "assets/banner1.jpg", group: "piano" },
  { title: "SWORD ART ONLINE", src: "assets/SWORD ART ONLINE PIANO MEDLEY!!! (30,000 Subscribers Special).mp3", cover: "assets/banner1.jpg", group: "piano" },
  { title: "ç»™æˆ‘ä¸€é¦–æ­Œçš„æ—¶é—´", src: "assets/ç»™æˆ‘ä¸€é¦–æ­Œçš„æ—¶é—´ piano ver-.mp3", cover: "assets/banner1.jpg", group: "chinesesong" },
  { title: "æ™´å¤©", src: "assets/å‘¨æ°ä¼¦æ™´å¤© é’¢ç´ç‹¬å¥ Jay ChouBi.Bi Piano.mp3", cover: "assets/banner1.jpg", group: "chinesesong" }
];

/* ===== state ===== */
let currentSong = 0;        // index in global songs[]
let currentGroup = 'piano'; // default selected group
const audio = new Audio();
audio.preload = 'auto';

/* ===== elements ===== */
const playPauseBtn = document.getElementById('playPauseBtn');
const nextBtn = document.getElementById('nextBtn');
const titleEl = document.getElementById('songTitle');
const playerEl = document.getElementById('elysiaPlayer');
const containerEl = document.getElementById('playlistContainer');
const playlistEl = document.getElementById('playlist');
const groupPanelEl = document.getElementById('groupPanel');

/* ===== helpers ===== */
function filteredList() {
  return songs.map((s,i)=>({...s, _idx:i})).filter(s=>s.group === currentGroup);
}
function renderPlaylist() {
  const list = filteredList();
  // Ensure height sync: make group panel same min-height as playlist (approx)
  // We set min-height of group panel equal to playlist scrollHeight after render.
  playlistEl.innerHTML = list.map(item => {
    const active = item._idx === currentSong ? 'active' : '';
    return `<div class="playlist-item ${active}" data-index="${item._idx}">${escapeHtml(item.title)}</div>`;
  }).join('');
  // sync group panel height to playlist element (so they look unified)
  // Use a small timeout to allow CSS/layout to settle
  setTimeout(()=> {
    const h = playlistEl.getBoundingClientRect().height || 56;
    groupPanelEl.style.minHeight = (h + 20) + 'px'; // padding compensation
  }, 30);
}

function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

/* ===== playback control ===== */
function updateSongUI() {
  const s = songs[currentSong];
  titleEl.textContent = s.title;
  // update active class in playlist
  playlistEl.querySelectorAll('.playlist-item').forEach(el => el.classList.remove('active'));
  const activeEl = playlistEl.querySelector(`.playlist-item[data-index="${currentSong}"]`);
  if (activeEl) activeEl.classList.add('active');
  updateMediaSession(s);
}

function playIndex(idx) {
  if (idx < 0 || idx >= songs.length) return;
  currentSong = idx;
  audio.src = songs[currentSong].src;
  audio.play().catch(()=>{});
  playPauseBtn.textContent = 'â¸';
  updateSongUI();
}

function playNext() {
  // if next within same group exists, prefer it; otherwise move to next global index
  const list = filteredList();
  const curPos = list.findIndex(it=>it._idx === currentSong);
  if (curPos >= 0 && curPos < list.length - 1) {
    playIndex(list[curPos+1]._idx);
  } else {
    // fallback: next global
    currentSong = (currentSong + 1) % songs.length;
    playIndex(currentSong);
  }
}

/* ===== media session (lock screen) ===== */
function updateMediaSession(song) {
  if (!('mediaSession' in navigator)) return;
  try {
    navigator.mediaSession.metadata = new MediaMetadata({
      title: song.title,
      artist: 'Elysia',
      album: song.group || 'Collection',
      artwork: [
        { src: song.cover || 'assets/banner1.jpg', sizes: '192x192', type: 'image/jpeg' }
      ]
    });
    navigator.mediaSession.playbackState = audio.paused ? 'paused' : 'playing';
    navigator.mediaSession.setActionHandler('nexttrack', playNext);
    navigator.mediaSession.setActionHandler('play', () => audio.play());
    navigator.mediaSession.setActionHandler('pause', () => audio.pause());
  } catch(e){}
}

/* ===== event bindings ===== */
playPauseBtn.addEventListener('click', () => {
  if (audio.paused || !audio.src) {
    audio.play().catch(()=>{});
    playPauseBtn.textContent = 'â¸';
  } else {
    audio.pause();
    playPauseBtn.textContent = 'â–¶';
  }
});
nextBtn.addEventListener('click', () => { playNext(); });

audio.addEventListener('play', () => { playerEl.classList.add('playing'); updateMediaSession(songs[currentSong]); });
audio.addEventListener('pause', () => { playerEl.classList.remove('playing'); updateMediaSession(songs[currentSong]); });
audio.addEventListener('ended', () => { playNext(); });

/* playlist click -> play */
playlistEl.addEventListener('click', e => {
  const item = e.target.closest('.playlist-item');
  if (!item) return;
  const idx = parseInt(item.dataset.index, 10);
  if (!isNaN(idx)) playIndex(idx);
});

/* group panel click -> switch group */
groupPanelEl.addEventListener('click', e => {
  const item = e.target.closest('.group-item');
  if (!item) return;
  // switch active visual
  groupPanelEl.querySelectorAll('.group-item').forEach(i => i.classList.remove('active'));
  item.classList.add('active');
  // change group and re-render; keep currentSong if it belongs to this group, else pick first of group
  const newGroup = item.dataset.group;
  currentGroup = newGroup;
  renderPlaylist();
  // if currentSong not in new group, set to first of new group
  const list = filteredList();
  if (list.length > 0) {
    if (!list.some(it => it._idx === currentSong)) {
      playIndex(list[0]._idx);
    } else {
      // keep currentSong but still update UI classes
      updateSongUI();
    }
  } else {
    // no songs in group: stop playback
    audio.pause();
    playPauseBtn.textContent = 'â–¶';
    playlistEl.innerHTML = '<div style="color:rgba(120,90,180,0.45);padding:8px;text-align:center;">No songs</div>';
  }
});

/* toggle playlist container */
function togglePlaylist() {
  const shown = containerEl.classList.toggle('show');
  // update aria
  document.getElementById('playlistContainer').setAttribute('aria-hidden', shown ? 'false' : 'true');
}
titleEl.addEventListener('click', e => { e.stopPropagation(); togglePlaylist(); });
document.addEventListener('click', e => {
  if (!containerEl.contains(e.target) && e.target !== titleEl) {
    containerEl.classList.remove('show');
  }
});

/* auto-hide player after inactivity (preserve original behavior) */
let inactivityTimer;
function showPlayer() {
  playerEl.style.opacity = '1';
  playerEl.style.transform = 'translateX(-50%)';
  playerEl.style.pointerEvents = 'auto';
  resetTimer();
}
function hidePlayer() {
  playerEl.style.opacity = 'function hidePlayer() {
  playerEl.style.opacity = '0.6';
  playerEl.style.transform = 'translateX(-50%) translateY(6px)';
  playerEl.style.pointerEvents = 'none';
}

function resetTimer() {
  clearTimeout(inactivityTimer);
  inactivityTimer = setTimeout(hidePlayer, 30000); // 30 ç§’æ— æ“ä½œè‡ªåŠ¨éšè—
}
document.addEventListener('mousemove', showPlayer);
document.addEventListener('keydown', showPlayer);

/* ===== åˆå§‹åŒ– ===== */
renderPlaylist();
playIndex(filteredList()[0]._idx);
showPlayer();

/* copyright */
console.log('Â© bestElysia 2025 â€” All Rights Reserved');
</script>

</body>
</html>